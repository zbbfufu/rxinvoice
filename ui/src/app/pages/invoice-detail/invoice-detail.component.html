<div class="invoice full-height">
    <div class="row align-middle invoiceHeader">
        <div class="columns shrink">
            <a class="button small white ripple"
               routerLink="/app/invoices"><i class="ion-arrow-left-c"></i></a>
        </div>

        <div class="columns shrink invoiceHeader-name">
            {{ (invoice && invoice._id) ? invoice.reference : 'invoices.label.back' | translate }}
            {{ (invoice && invoice.business) ? '- ' + invoice.business.name : '' }}
        </div>
    </div>

    <div class="row invoiceDetail" [ngClass]="{'mode-edit': form.enabled}">
        <form [formGroup]="form" *ngIf="form && invoice" (submit)="save()" novalidate class="column small-8">
            <div class="column invoiceDetail-container dark">

                <div class="row align-middle invoiceDetail-container-valueNumber">
                    <h6 class="column small-8"> {{'invoices.label.client' | translate}}</h6>
                    <div class="column">
                        <select formControlName="buyer" [compareWith]="comparFn">
                            <option [ngValue]="">{{'invoices.filter.client' | translate}}</option>
                            <option *ngFor="let company of companies" [ngValue]="company">
                                {{company.name}}
                            </option>
                        </select>
                    </div>
                </div>

                <div class="row align-middle invoiceDetail-container-label">
                    <h6 class="column small-8"> {{'invoice.business' | translate}}</h6>
                    <div class="column">
                        <input type="text" formControlName="businessName"
                               class="form-control"/>
                    </div>
                </div>

                <div class="row align-middle invoiceDetail-container-label">
                    <h6 class="column small-8"> {{'invoice.kind' | translate}}</h6>
                    <div class="column">
                        <select formControlName="kind">
                        <option value="">{{'invoice.kind.all' | translate}}</option>
                        <option *ngFor="let kind of kinds" [ngValue]="kind">
                            {{'invoice.kind.' + kind | translate}}
                        </option>
                    </select>
                    </div>
                </div>

                <div class="row align-middle invoiceDetail-container-label">
                    <h6 class="column small-8"> {{'invoice.label.date' | translate}}</h6>
                    <div class="column">{{invoice.date | date: 'dd MMM. yyyy'}}</div>
                </div>

                <div class="row align-middle invoiceDetail-container-label"
                     *ngIf="invoice?.creationDate">
                    <h6 class="column small-8"> {{'invoice.label.creation' | translate}}</h6>
                    <div class="column">{{invoice.creationDate | date: 'dd MMM. yyyy'}}</div>
                </div>

                <div class="row align-middle invoiceDetail-container-label">
                    <h6 class="column small-8"> {{'invoice.label.dueDate' | translate}}</h6>
                    <div class="column">
                        <date-picker [control]="form.controls.dueDate"
                                     [utcMode]="true" [disabled]="form.disabled"></date-picker>
                    </div>
                </div>

                <div class="row align-middle invoiceDetail-container-label">
                    <h6 class="column small-8"> {{'invoice.label.date' | translate}}</h6>
                    <div class="column">{{invoice.sentDate | date: 'dd MMM. yyyy'}}</div>
                </div>


                <div class="row align-middle invoiceDetail-container-label">
                    <h6 class="column small-8"> {{'invoice.label.status' | translate}}</h6>
                    <div class="column">
                        <select formControlName="status">
                            <option value="">{{'invoice.status.all' | translate}}</option>
                            <option *ngFor="let status of statuses" [ngValue]="status">
                                {{'invoice.status.' + status | translate}}
                            </option>
                        </select>
                    </div>
                </div>

                <div class="row align-middle invoiceDetail-container-label">
                    <h6 class="column small-8"> {{'invoice.label.comments' | translate}}</h6>
                    <div class="column" class="panel panel-default">
                           <textarea type="text" formControlName="comment"
                                     rows="10" cols="50">
                           </textarea>
                    </div>
                </div>
            </div>
        </form>

        <div class="column auto invoiceDetail" *ngIf="invoice">
            <invoice-lines-detail [(lines)]="lines" [editMode]="form.enabled"></invoice-lines-detail>
            <vat-detail [editMode]="form.enabled" [(vats)]="invoice.vats"></vat-detail>
            <attachments-detail [editMode]="form.enabled" [(attachments)]="invoice.attachments"></attachments-detail>
        </div>
    </div>

    <footer class="row invoiceAction">
            <span class="overlay-state-edit" *ngIf="form.enabled">
                <i class="ion-edit"></i>
            </span>
        <div class="column">
            <div class="row invoiceAction-container align-middle">
                <div class="columns shrink">
                    <button *ngIf="form.enabled"
                            class="button medium green ripple"
                            type="submit"
                            (click)="invoice && invoice._id  ? save() : create()"
                            [disabled]="form.invalid || form.pending">
                        <i class="ion-checkmark-round"></i>
                        {{( !invoice ? 'button.label.create' : 'button.label.update') | translate}}
                    </button>
                    <button *ngIf="form.disabled"
                            (click)="form.enable()"
                            class="button medium green ripple">
                        <i class="ion-edit"></i>
                        Modifier
                    </button>
                </div>

                <div class="columns shrink">
                    <button class="button medium grey ripple"
                            type="button"
                            (click)="invoice && invoice._id ? delete() : f.reset()">
                        <i class="ion-trash-a"></i>{{'button.label.delete' | translate}}
                    </button>
                </div>

                <div class="columns medium">
                    <button *ngIf="form.enabled"
                            class="button medium grey ripple"
                            type="button"
                            (click)="reset()">
                        <i class="ion-arrow-return-left"></i>{{'button.label.cancel' | translate}}
                    </button>
                </div>

            </div>
        </div>
    </footer>
</div>